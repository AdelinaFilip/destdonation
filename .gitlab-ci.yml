stages:
  - test
  - staging
  - production

testing frontend:
  stage: test
  script:
    - cd client
    - npm ci
    - npm run test:CI

testing backend:
  stage: test
  script:
    - npm ci
    - npm run test:CI

deploying to VM:
  stage: staging
  before_script:
    - pkill -9 screen || echo "Screen not running"
  script:
    - npm ci
    - npm build
    - screen -dm npm start
  environment:
    name: VM
    url: $IP:$PORT
  only:
    - develop

deploying to heroku:
  stage: production
  script:
    - dpl --provider=heroku --app=shielded-savannah-74147 --api-key=$HEROKU_API_KEY
  environment:
    name: Heroku
    url: https://shielded-savannah-74147.herokuapp.com/
  only:
    - master
